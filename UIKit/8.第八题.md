## 8.如何暂停一个 `UIView` 中正在播放的动画？暂停后如何恢复？


实现方案是按照这篇博客写的 ： https://blog.csdn.net/yuanyuan1314521/article/details/50033171

```objc
- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event

{
    _number++;
    
    if (_number % 2 == 1) {

        [self pauseLayer:self.view.layer];
    }

    if (_number % 2 == 0) {

        [self resumeLayer:self.view.layer];
    }
}



//暂停动画

- (void)pauseLayer:(CALayer*)layer

{
    CFTimeInterval pausedTime = [layer convertTime:CACurrentMediaTime() fromLayer:nil];

    layer.speed = 0.0;

    layer.timeOffset = pausedTime;
}



//继续layer上面的动画
-(void)resumeLayer:(CALayer*)layer

{

    CFTimeInterval pausedTime = [layer timeOffset];

    layer.speed = 1.0;
    layer.timeOffset = 0.0;
    layer.beginTime = 0.0;

    CFTimeInterval timeSincePause = [layer convertTime:CACurrentMediaTime() fromLayer:nil] - pausedTime;

    layer.beginTime = timeSincePause;
}
```


自己实现了一下代码
```
#import "ViewController.h"
#import "GHAnimationView.h"

@interface ViewController ()

@property (nonatomic, strong) UIButton *runBtn;
@property (nonatomic, strong) UIButton *pauseBtn;
@property (nonatomic, strong) UIButton *beginBtn;

@property (nonatomic, strong) GHAnimationView *animateView;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    _runBtn = [UIButton buttonWithType:UIButtonTypeCustom];
    [self.view addSubview:_runBtn];
    _runBtn.frame = CGRectMake(0.f, 100.f, 100.f, 40.f);
    [_runBtn setTitle:@"运行" forState:UIControlStateNormal];
    _runBtn.backgroundColor = [UIColor yellowColor];
    [_runBtn addTarget:self action:@selector(onRunAction:) forControlEvents:UIControlEventTouchUpInside];

    _pauseBtn = [UIButton buttonWithType:UIButtonTypeCustom];
    [self.view addSubview:_pauseBtn];
    [_pauseBtn  setTitle:@"停止" forState:UIControlStateNormal];
    _pauseBtn.frame = CGRectMake(130.f, 100.f, 100.f, 40.f);
    _pauseBtn.backgroundColor = [UIColor redColor];
    [_pauseBtn addTarget:self action:@selector(onPauseAction:) forControlEvents:UIControlEventTouchUpInside];

    _beginBtn = [UIButton buttonWithType:UIButtonTypeCustom];
    [self.view addSubview:_beginBtn];
    _beginBtn.frame = CGRectMake(250.f, 100.f, 100.f, 40.f);
    _beginBtn.backgroundColor = [UIColor greenColor];
    [_beginBtn addTarget:self action:@selector(onBeginAction:) forControlEvents:UIControlEventTouchUpInside];
    [_beginBtn setTitle:@"重置" forState:UIControlStateNormal];
    
    _animateView = [[GHAnimationView alloc] initWithFrame:CGRectMake(0.f, 200.f, 50.f, 50.f)];
    [self.view addSubview:_animateView];
    _animateView.backgroundColor = [UIColor purpleColor];
    __weak typeof (self) wSelf = self;
    [UIView animateWithDuration:10.f animations:^{
        wSelf.animateView.frame = CGRectMake(400.f, 200.f, 50.f, 50.f);
    }];
   
}

- (void)onRunAction:(id)sender {
    [self resumeLayer:self.animateView.layer];
}

- (void)onPauseAction:(id)sender {
    [self pauseLayer:self.animateView.layer];
}

//暂停动画
- (void)pauseLayer:(CALayer*)layer {
    CFTimeInterval pausedTime = [layer convertTime:CACurrentMediaTime() fromLayer:nil];
    layer.speed = 0.0;
    layer.timeOffset = pausedTime;
}

- (void)onBeginAction:(UIButton *)btn {
    self.animateView.layer.beginTime = 0.f;
    self.animateView.layer.speed = 1.f;
}

//继续layer上面的动画
-(void)resumeLayer:(CALayer*)layer {
    CFTimeInterval pausedTime = [layer timeOffset];
    layer.speed = 1.0;
    layer.timeOffset = 0.0;
    layer.beginTime = 0.0;
    CFTimeInterval timeSincePause = [layer convertTime:CACurrentMediaTime() fromLayer:nil] - pausedTime;
    layer.beginTime = timeSincePause;
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
}

@end



```





